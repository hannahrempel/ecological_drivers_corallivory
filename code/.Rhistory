View(pf_density_biomass_site)
if (!require(broom.mixed)) install.packages("broom.mixed")
if (!require(cowplot)) install.packages("cowplot")
if (!require(DHARMa)) install.packages("DHARMa")
if (!require(ggpp)) install.packages("ggpp")
if (!require(ggpubr)) install.packages("ggpubr")
if (!require(ggridges)) install.packages("ggridges")
if (!require(glmmTMB)) install.packages("glmmTMB")
if (!require(here)) install.packages("here")
if (!require(janitor)) install.packages("janitor")
if (!require(magick)) install.packages("magick")
if (!require(tidyverse)) install.packages("tidyverse")
packages <- c("broom.mixed", "cowplot", "DHARMa", "ggpp", "ggpubr", "ggridges", "glmmTMB", "here", "janitor", "magick", "tidyverse")
sapply(packages, require, character.only = T)
fish_df <- read_csv(here("data/regional_fish_data.csv")) %>%
mutate(region= factor(region, levels = c("Panamá", "Florida",  "St. Croix", "Bonaire")))
coral_scar_df <- read.csv(here("data/processed_coral_scar_data_colony_level.csv"),
fileEncoding = "UTF-8") %>% #UTF-8 is compatible with accents/tildes
mutate(region= factor(region, levels = c("Panamá", "Florida", "St. Croix", "Bonaire")))
site_coordinates <- read.csv(here("data/site_coordinates.csv"),
fileEncoding = "UTF-8") %>%
mutate(region= factor(region, levels = c("Panamá", "Florida", "St. Croix", "Bonaire")))
#summary of the number of transects and depth range by site
summarized_n_depth_fish_surveys <- fish_df  %>%
group_by(region, site, transect) %>%
distinct(depth_m) %>%
rename(fish_survey_depth_m = depth_m) %>%
group_by(region, site) %>%
dplyr::reframe(n_fish_surveys=n(),
min_fish_survey_depth_m = min(fish_survey_depth_m),
med_fish_survey_depth_m = round(median(fish_survey_depth_m), 1),
max_fish_survey_depth_m = max(fish_survey_depth_m))
#summary of the number of surveys and depth range by site
summarized_n_depth_coral_surveys <- coral_scar_df %>%
group_by(region, site, transect) %>%
distinct(depth_m) %>%
rename(coral_survey_depth_m = depth_m) %>%
group_by(region, site) %>%
dplyr::reframe(n_coral_surveys = n(),
min_coral_survey_depth_m = min(coral_survey_depth_m),
med_coral_survey_depth_m = round(median(coral_survey_depth_m), 1),
max_coral_survey_depth_m = max(coral_survey_depth_m))
#joining site-level sampling effort summary with site coordinates
table_s1 <- site_coordinates %>%
left_join(summarized_n_depth_fish_surveys) %>%
left_join(summarized_n_depth_coral_surveys)
write.csv(table_s1,
here("figures_tables/supplements_tables/table_s1_site_coordinates_sample_size.csv"),
fileEncoding = "UTF-8",
row.names=FALSE)
#function to calculate the standard error of the mean
sem <- function(x) {
sd(x, na.rm=TRUE)/sqrt(sum(!is.na(x)))
}
# transect-level summary of fish density and biomass
pf_density_biomass_transect <- fish_df %>%
mutate(survey_area_m2 = survey_l_m*survey_w_m) %>%
group_by(region, site, date, transect, depth_m, survey_l_m, survey_w_m, survey_area_m2) %>%
dplyr::reframe(n_major_corallivores = sum(count),
sum_corallivore_weight_g = sum(weight_g)) %>%
mutate(density_major_corallivores = n_major_corallivores/survey_area_m2*100, #fish density (n/100 m2)
biomass_major_corallivores = sum_corallivore_weight_g/survey_area_m2*100) #fish biomass (g/100 m2)
# site-level summary of fish density amd biomass
pf_density_biomass_site <- pf_density_biomass_transect %>%
group_by(region, site) %>%
dplyr::reframe(
mean_pf_n_100m2=mean(density_major_corallivores),
sem_pf_density = sem(density_major_corallivores),
mean_pf_g_100m2=mean(biomass_major_corallivores),
sem_pf_biomass = sem(biomass_major_corallivores)
) %>%
ungroup()
View(pf_density_biomass_site)
# transect-level summary of coral data
coral_transect <- coral_scar_df %>%
mutate(proportion_grazed = total_grazed_cm2/col_area_cm2) %>%
group_by(region, site, transect, depth_m) %>%
dplyr::reframe(
total_col_area_cm2 = sum(col_area_cm2),
total_scar_area_cm2 = sum(total_grazed_cm2),
total_n_scars = sum(n_new_scars),
n_colonies = n()) %>%
mutate(
pct_coral_cover = (total_col_area_cm2/300000)*100, #divide by 300000 b/c coral transects were 30m2 (=300000cm2)
scars_m2_coral = total_n_scars/(total_col_area_cm2/10000), #divide by 10000 to convert cm2 to m2
pct_coral_grazed = (total_scar_area_cm2/total_col_area_cm2)*100) %>% #multiplying by 100 to convert to percent
ungroup()
# site-level summary of coral data
coral_site <- coral_transect %>%
group_by(region, site) %>%
dplyr::reframe(
mean_pct_coral_cover = mean(pct_coral_cover),
sem_coral_cover = sem(pct_coral_cover),
mean_pct_coral_grazed = mean(pct_coral_grazed),
sem_pct_grazed = sem(pct_coral_grazed),
mean_scars_m2_coral = mean(scars_m2_coral),
sem_scar_density = sem(scars_m2_coral)
) %>%
ungroup()
View(coral_site)
