fla13_pan13 <- read.csv(here("data/fla13_pan13_fish_data.csv"), fileEncoding = "UTF-8") %>% #so accents are read in correctly
mutate(date=as.Date(date))
fish_ab_vals <- read_csv(here("data/fish_ab_values.csv"))
checking_average_segment_length <- stx18_bon19 %>%
mutate(dist_m_rnd =round(dist_m, 0)) %>%
select(site, transect, min, dist_m_rnd) %>%
distinct() %>%
filter(dist_m_rnd >=15 & dist_m_rnd <=25)
hist(checking_average_segment_length$dist_m_rnd)
#subsetting data to only include surveys between 16 to 20m
fish_df_16_to_20 <- stx18_bon19 %>%
filter(dist_m >=16 & dist_m <=20) %>%
mutate(dist_m =round(dist_m, 0)) %>%
select(region, date, site, transect, species, stage, fl_cm, n_pf, dist_m, min, depth_m)
segment_filter_df <- fish_df_16_to_20 %>%
select(region, date, site, transect, min) %>%
distinct() %>%
mutate(segment_id=cumsum(distinct_segment= min != lag(min) + 1 | is.na(min != lag(min) + 1))) %>%
group_split(segment_id) %>%
map(~.x %>% mutate(row_num=row_number(), row_to_keep=row_num %%2==1)) %>%
bind_rows() %>%
select(-segment_id, -row_num)
fish_df_filtered <- fish_df_16_to_20 %>%
dplyr::left_join(segment_filter_df) %>%
filter(row_to_keep==TRUE)
fish_replicate_check <- fish_df_filtered %>%
select(region, date, site, transect, min, dist_m) %>%
distinct() %>%
group_by(region, site) %>%
dplyr::reframe(n=n())
stx_bon19_transect_temp <- fish_df_filtered %>%
select(region, site, date, transect_old=transect, min, dist_m, depth_m) %>%
distinct() %>%
group_by(region, site) %>%
mutate(transect=1:n())
stx_bon19_metadata <- stx_bon19_transect_temp %>%
mutate(survey_w_m=5) %>%
select(region, site, date, transect, depth_m, survey_l_m= dist_m, survey_w_m) %>%
mutate(depth_m=round(depth_m, 1)) %>%
distinct()
stx18_bon19_clean <- fish_df_filtered %>%
rename(transect_old=transect, number=n_pf, phase=stage, size_cm=fl_cm) %>%
dplyr::left_join(stx_bon19_transect_temp, by = c("region", "date", "site", "min", "transect_old", "depth_m")) %>%
select(region, site, date, transect, depth_m, species,phase, size_cm, number) %>%
mutate(depth_m=round(depth_m, 1),
size_cm=as.character(size_cm))
fish_survey_metadata <- fla13_pan13 %>%
mutate(survey_l_m=25, survey_w_m=4) %>%
select(region, site, date, transect, depth_m, survey_l_m, survey_w_m) %>%
distinct() %>%
bind_rows(stx_bon19_metadata)
merged_fish_surveys <- fla13_pan13 %>%
filter(number>0) %>% #filtering to only include observations with fish
uncount(number) %>%
bind_rows(stx18_bon19_clean) %>%
select(-number)%>%
mutate(count=1)
major_corallivores_df <-  merged_fish_surveys %>%
filter(species %in% c("Scarus taeniopterus", "Scarus vetula", "Sparisoma viride")) #filtering to only include predominant corallivore species
major_corallivore_counts_df <- fish_survey_metadata %>%
dplyr::left_join(major_corallivores_df) %>%
mutate(species=replace_na(species, "No major corallivores"), #accounting for transects with no observed major corallivores
count=replace_na(count, 0))
filtered_fish_ab_vals <- fish_ab_vals %>%
filter(species %in% c("Scarus taeniopterus", "Scarus vetula", "Sparisoma viride")) %>% #selecting species of interest
group_by(species) %>%
filter(rsquared>0.85 | is.na(rsquared)) %>% #filtering out values with low R2
slice_max(n_obs, n=1) %>% #from values with R2>0.85, selecting those with the max species observed
select(species, a, b)
major_corallivore_counts_weights_df <-major_corallivore_counts_df %>%
left_join(filtered_fish_ab_vals) %>%
mutate(size_cm_est=case_when( #NAs introduced by coersion warning caused by NA's for transects with no fish (i.e., not an issue)
size_cm=="15 to 20"~17.5, #midpoint within size bin
size_cm=="20 to 25"~22.5,
size_cm=="25 to 30"~27.5,
TRUE~as.numeric(size_cm))
) %>%
mutate(weight_g=a*size_cm_est^b) %>% #calculating estimated fish weight per individual
mutate(weight_g=case_when(is.na(weight_g)~0, #adding in 0's for cases where no fish were observed in a transect
TRUE~as.numeric(weight_g)))
if (!require(here)) install.packages("here")
if (!require(purrr)) install.packages("purrr")
if (!require(tidyverse)) install.packages("tidyverse")
packages <- c("here", "purrr", "tidyverse")
sapply(packages, require, character.only = T)
stx18_bon19 <- read_csv(here("data/stx18_bon19_fish_data.csv")) %>%
mutate(date=as.Date(date, "%m/%d/%y"))
fla13_pan13 <- read.csv(here("data/fla13_pan13_fish_data.csv"), fileEncoding = "UTF-8") %>% #so accents are read in correctly
mutate(date=as.Date(date))
fish_ab_vals <- read_csv(here("data/fish_ab_values.csv"))
checking_average_segment_length <- stx18_bon19 %>%
mutate(dist_m_rnd =round(dist_m, 0)) %>%
select(site, transect, min, dist_m_rnd) %>%
distinct() %>%
filter(dist_m_rnd >=15 & dist_m_rnd <=25)
hist(checking_average_segment_length$dist_m_rnd)
#subsetting data to only include surveys between 16 to 20m
fish_df_16_to_20 <- stx18_bon19 %>%
filter(dist_m >=16 & dist_m <=20) %>%
mutate(dist_m =round(dist_m, 0)) %>%
select(region, date, site, transect, species, stage, fl_cm, n_pf, dist_m, min, depth_m)
segment_filter_df <- fish_df_16_to_20 %>%
select(region, date, site, transect, min) %>%
distinct() %>%
mutate(segment_id=cumsum(distinct_segment= min != lag(min) + 1 | is.na(min != lag(min) + 1))) %>%
group_split(segment_id) %>%
map(~.x %>% mutate(row_num=row_number(), row_to_keep=row_num %%2==1)) %>%
bind_rows() %>%
select(-segment_id, -row_num)
fish_df_filtered <- fish_df_16_to_20 %>%
dplyr::left_join(segment_filter_df) %>%
filter(row_to_keep==TRUE)
fish_replicate_check <- fish_df_filtered %>%
select(region, date, site, transect, min, dist_m) %>%
distinct() %>%
group_by(region, site) %>%
dplyr::reframe(n=n())
stx_bon19_transect_temp <- fish_df_filtered %>%
select(region, site, date, transect_old=transect, min, dist_m, depth_m) %>%
distinct() %>%
group_by(region, site) %>%
mutate(transect=1:n())
stx_bon19_metadata <- stx_bon19_transect_temp %>%
mutate(survey_w_m=5) %>%
select(region, site, date, transect, depth_m, survey_l_m= dist_m, survey_w_m) %>%
mutate(depth_m=round(depth_m, 1)) %>%
distinct()
stx18_bon19_clean <- fish_df_filtered %>%
rename(transect_old=transect, number=n_pf, phase=stage, size_cm=fl_cm) %>%
dplyr::left_join(stx_bon19_transect_temp, by = c("region", "date", "site", "min", "transect_old", "depth_m")) %>%
select(region, site, date, transect, depth_m, species,phase, size_cm, number) %>%
mutate(depth_m=round(depth_m, 1),
size_cm=as.character(size_cm))
fish_survey_metadata <- fla13_pan13 %>%
mutate(survey_l_m=25, survey_w_m=4) %>%
select(region, site, date, transect, depth_m, survey_l_m, survey_w_m) %>%
distinct() %>%
bind_rows(stx_bon19_metadata)
merged_fish_surveys <- fla13_pan13 %>%
filter(number>0) %>% #filtering to only include observations with fish
uncount(number) %>%
bind_rows(stx18_bon19_clean) %>%
select(-number)%>%
mutate(count=1)
major_corallivores_df <-  merged_fish_surveys %>%
filter(species %in% c("Scarus taeniopterus", "Scarus vetula", "Sparisoma viride")) #filtering to only include predominant corallivore species
major_corallivore_counts_df <- fish_survey_metadata %>%
dplyr::left_join(major_corallivores_df) %>%
mutate(species=replace_na(species, "No major corallivores"), #accounting for transects with no observed major corallivores
count=replace_na(count, 0))
filtered_fish_ab_vals <- fish_ab_vals %>%
filter(species %in% c("Scarus taeniopterus", "Scarus vetula", "Sparisoma viride")) %>% #selecting species of interest
group_by(species) %>%
filter(rsquared>0.85 | is.na(rsquared)) %>% #filtering out values with low R2
slice_max(n_obs, n=1) %>% #from values with R2>0.85, selecting those with the max species observed
select(species, a, b)
major_corallivore_counts_weights_df <-major_corallivore_counts_df %>%
left_join(filtered_fish_ab_vals) %>%
mutate(size_cm_est=case_when( #NAs introduced by coersion warning caused by NA's for transects with no fish (i.e., not an issue)
size_cm=="15 to 20"~17.5, #midpoint within size bin
size_cm=="20 to 25"~22.5,
size_cm=="25 to 30"~27.5,
TRUE~as.numeric(size_cm))
) %>%
mutate(weight_g=a*size_cm_est^b) %>% #calculating estimated fish weight per individual
mutate(weight_g=case_when(is.na(weight_g)~0, #adding in 0's for cases where no fish were observed in a transect
TRUE~as.numeric(weight_g)))
write.csv(major_corallivore_counts_weights_df,
here("data/regional_fish_data.csv"),
fileEncoding = "UTF-8",
row.names = FALSE)
# Transect-level summary of fish density
major_corallivores_df <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #summarizing transect metadata
group_by(region, site, date, transect, depth_m, survey_l_m, survey_w_m, survey_area_m2) %>%
dplyr::reframe(n_major_corallivores=n())
major_corallivores_df
fish_df
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=80), tidy=TRUE)
if (!require(broom)) install.packages("broom")
if (!require(broom.mixed)) install.packages("broom.mixed")
if (!require(cowplot)) install.packages("cowplot")
if (!require(DHARMa)) install.packages("DHARMa")
if (!require(electivity)) install.packages("electivity")
if (!require(ggpp)) install.packages("ggpp")
if (!require(ggpubr)) install.packages("ggpubr")
if (!require(ggridges)) install.packages("ggridges")
if (!require(glmmTMB)) install.packages("glmmTMB")
if (!require(here)) install.packages("here")
if (!require(janitor)) install.packages("janitor")
if (!require(magick)) install.packages("magick")
if (!require(moderndive)) install.packages("moderndive")
if (!require(tidyverse)) install.packages("tidyverse")
packages <- c("broom", "broom.mixed", "cowplot", "DHARMa", "electivity", "ggpp", "ggpubr", "ggridges", "glmmTMB", "here", "janitor", "magick", "moderndive", "tidyverse")
sapply(packages, require, character.only = T)
fish_df <- read_csv(here("data/regional_fish_data.csv")) %>%
mutate(region= factor(region, levels = c("Panam√°", "Florida",  "St. Croix", "Bonaire")))
coral_scar_df <- read.csv(here("data/processed_coral_scar_data_colony_level.csv"),
fileEncoding = "UTF-8") %>% #UTF-8 is compatible with accents/tildes
mutate(region= factor(region, levels = c("Panam√°", "Florida", "St. Croix", "Bonaire")))
site_coordinates <- read.csv(here("data/site_coordinates.csv"),
fileEncoding = "UTF-8") %>%
mutate(region= factor(region, levels = c("Panam√°", "Florida", "St. Croix", "Bonaire")))
#depth of each fish survey transect
depth_fish_surveys <- fish_df  %>%
group_by(region, site, transect) %>%
distinct(depth_m)%>%
rename(fish_survey_depth_m=depth_m)
#summary of the number of transects and depth range by site
summarized_n_depth_fish_surveys<-depth_fish_surveys %>%
group_by(region, site) %>%
dplyr::reframe(n_fish_surveys=n(),
min_fish_survey_depth_m =min(fish_survey_depth_m),
med_fish_survey_depth_m =round(median(fish_survey_depth_m), 1),
max_fish_survey_depth_m =max(fish_survey_depth_m))
#depth of each coral and scar survey
depth_coral_surveys <- coral_scar_df %>%
group_by(region, site, transect) %>%
distinct(depth_m) %>%
rename(coral_survey_depth_m=depth_m)
#summary of the number of surveys and depth range by site
summarized_n_depth_coral_surveys<-depth_coral_surveys %>%
group_by(region, site) %>%
dplyr::reframe(n_coral_surveys=n(),
min_coral_survey_depth_m =min(coral_survey_depth_m),
med_coral_survey_depth_m =round(median(coral_survey_depth_m), 1),
max_coral_survey_depth_m =max(coral_survey_depth_m))
#joining site-level sampling effort summary with site coordinates
table_s1 <- site_coordinates %>%
left_join(summarized_n_depth_fish_surveys) %>%
left_join(summarized_n_depth_coral_surveys)
write.csv(table_s1,
here("supplements/table_s1_site_coordinates_sample_size.csv"),
fileEncoding = "UTF-8",
row.names=FALSE)
fish_df
# Transect-level summary of fish density
major_corallivores_df <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #summarizing transect metadata
group_by(region, site, date, transect, depth_m, survey_l_m, survey_w_m, survey_area_m2) %>%
dplyr::reframe(n_major_corallivores=n(), total_corallivore_weight=sum(weight_g))
View(major_corallivores_df)
# Transect-level summary of fish density
major_corallivores_df <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #summarizing transect metadata
group_by(region, site, date, transect, depth_m, survey_l_m, survey_w_m, survey_area_m2) %>%
dplyr::reframe(n_major_corallivores=n(), sum_corallivore_weight_g=sum(weight_g))
fish_df %>%
select(region, site, date, transect, depth_m, survey_area_m2) %>%
distinct()
fish_df %>%
select(region, site, date, transect, depth_m, survey_area_m2) %>%
distinct()
fish_df
# Transect-level summary of fish density
major_corallivores_df <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #summarizing transect metadata
group_by(region, site, date, transect, depth_m, survey_l_m, survey_w_m) %>%
dplyr::reframe(n_major_corallivores=n(), sum_corallivore_weight_g=sum(weight_g))
fish_survey_transect_metadata <- fish_df %>%
mutate(survey_area_m=survey_l_m*survey_w_m) %>% #calculating the area surveyed per transect
select(region, site, date, transect, depth_m, survey_area_m2) %>%
distinct() #taking distinct values (i.e., one row per transect)
fish_survey_transect_metadata
fish_survey_transect_metadata <- fish_df %>%
mutate(survey_area_m=survey_l_m*survey_w_m) %>% #calculating the area surveyed per transect
select(region, site, date, transect, depth_m, survey_area_m2) %>%
distinct() #taking distinct values (i.e., one row per transect)
fish_survey_transect_metadata <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #calculating the area surveyed per transect
select(region, site, date, transect, depth_m, survey_area_m2) %>%
distinct() #taking distinct values (i.e., one row per transect)
fish_survey_transect_metadata
table_s1
table_s1 %>% sum(n_fish_surveys)
table_s1 %>% sum(n_fish_surveys)
table_s1
sum(table_s1$n_fish_surveys)
fish_survey_transect_metadata <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #calculating the area surveyed per transect
select(region, site, date, transect, depth_m, survey_area_m2) %>%
distinct() #taking distinct values (i.e., one row per transect)
sum(table_s1$n_fish_surveys) ==length(fish_survey_transect_metadata)
length(fish_survey_transect_metadata)
fish_survey_transect_metadata
nrow(fish_survey_transect_metadata)
sum(table_s1$n_fish_surveys) ==nrow(fish_survey_transect_metadata)
major_corallivores_df
sum(table_s1$n_fish_surveys) ==nrow(major_corallivores_df)
#double checking that the fish abundance and total weight per transect summary has one row per transect
sum(table_s1$n_fish_surveys) ==nrow(major_corallivores_df)
#summarizing metadata of for each fish survey transect
fish_survey_transect_metadata <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #calculating the area surveyed per transect
select(region, site, date, transect, depth_m, survey_area_m2) %>%
distinct() #taking distinct values (i.e., one row per transect)
#double checking that the metadata only includes one row per transect
sum(table_s1$n_fish_surveys) ==nrow(fish_survey_transect_metadata)
fish_survey_transect_metadata %>%
left_join(major_corallivores_df)
Vew(major_corallivores_df)
View(major_corallivores_df)
fish_df
#transect-level summary of fish density
major_corallivores_df <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #summarizing transect metadata
group_by(region, site, date, transect, depth_m, survey_l_m, survey_w_m) %>%
dplyr::reframe(n_major_corallivores=sum(count), sum_corallivore_weight_g=sum(weight_g))
#double checking that the fish abundance and total weight per transect summary has one row per transect
sum(table_s1$n_fish_surveys) ==nrow(major_corallivores_df)
#summarizing metadata of for each fish survey transect
fish_survey_transect_metadata <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #calculating the area surveyed per transect
select(region, site, date, transect, depth_m, survey_area_m2) %>%
distinct() #taking distinct values (i.e., one row per transect)
#double checking that the metadata only includes one row per transect
sum(table_s1$n_fish_surveys) ==nrow(fish_survey_transect_metadata)
View(fish_df)
#merging data in transect-level summary of parrotfish density
pf_density_biomass_transect <- fish_survey_transect_metadata %>%
left_join(major_corallivores_df) %>% #adding in fish data
mutate(density_major_corallivores = n_major_corallivores/survey_area_m2*100, #calculating fish density (n/100 m2)
biomass_major_corallivores = sum_corallivore_weight_g/survey_area_m2*100) %>% #calculating fish biomass (g/100 m2)
ungroup()
pf_density_biomass_transect
# Site-level summary of fish density
pf_density_biomass_site<- pf_density_biomass_transect %>%
group_by(region, site) %>%
dplyr::reframe(mean_density_major_corallivores=mean(density_major_corallivores),
mean_biomass_major_corallivores=mean(biomass_major_corallivores)) %>%
ungroup()
# Site-level summary of fish density
pf_density_biomass_site<- pf_density_biomass_transect %>%
group_by(region, site) %>%
dplyr::reframe(mean_density_major_corallivores=mean(density_major_corallivores),
mean_biomass_major_corallivores=mean(biomass_major_corallivores)) %>%
ungroup()
#function to calculate the standard error of the mean
sem <- function(x) {
sd(x, na.rm=TRUE)/sqrt(sum(!is.na(x)))
}
# Region-level summary of fish density
regional_parrotfish_density <- pf_density_site %>%
group_by(region) %>%
dplyr::reframe(
mean_pf_density=mean(mean_density_major_corallivores),
sem_pf_density=sem(mean_density_major_corallivores),
mean_pf_biomass=mean(biomass_major_corallivores),
sem_pf_biomass=sem(biomass_major_corallivores))
#function to calculate the standard error of the mean
sem <- function(x) {
sd(x, na.rm=TRUE)/sqrt(sum(!is.na(x)))
}
# Site-level summary of fish density
pf_density_biomass_site<- pf_density_biomass_transect %>%
group_by(region, site) %>%
dplyr::reframe(mean_density_major_corallivores=mean(density_major_corallivores),
mean_biomass_major_corallivores=mean(biomass_major_corallivores)) %>%
ungroup()
# Region-level summary of fish density
regional_parrotfish_density <- pf_density_site %>%
group_by(region) %>%
dplyr::reframe(
mean_pf_density=mean(mean_density_major_corallivores),
sem_pf_density=sem(mean_density_major_corallivores),
mean_pf_biomass=mean(biomass_major_corallivores),
sem_pf_biomass=sem(biomass_major_corallivores))
# Region-level summary of fish density
regional_parrotfish_density <- pf_density_biomass_site %>%
group_by(region) %>%
dplyr::reframe(
mean_pf_density=mean(mean_density_major_corallivores),
sem_pf_density=sem(mean_density_major_corallivores),
mean_pf_biomass=mean(biomass_major_corallivores),
sem_pf_biomass=sem(biomass_major_corallivores))
# Region-level summary of fish density
regional_parrotfish_density <- pf_density_biomass_site %>%
group_by(region) %>%
dplyr::reframe(
mean_pf_density=mean(mean_density_major_corallivores),
sem_pf_density=sem(mean_density_major_corallivores),
mean_pf_biomass=mean(mean_biomass_major_corallivores),
sem_pf_biomass=sem(mean_biomass_major_corallivores))
regional_parrotfish_density
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=80), tidy=TRUE)
if (!require(broom)) install.packages("broom")
if (!require(broom.mixed)) install.packages("broom.mixed")
if (!require(cowplot)) install.packages("cowplot")
if (!require(DHARMa)) install.packages("DHARMa")
if (!require(electivity)) install.packages("electivity")
if (!require(ggpp)) install.packages("ggpp")
if (!require(ggpubr)) install.packages("ggpubr")
if (!require(ggridges)) install.packages("ggridges")
if (!require(glmmTMB)) install.packages("glmmTMB")
if (!require(here)) install.packages("here")
if (!require(janitor)) install.packages("janitor")
if (!require(magick)) install.packages("magick")
if (!require(moderndive)) install.packages("moderndive")
if (!require(tidyverse)) install.packages("tidyverse")
packages <- c("broom", "broom.mixed", "cowplot", "DHARMa", "electivity", "ggpp", "ggpubr", "ggridges", "glmmTMB", "here", "janitor", "magick", "moderndive", "tidyverse")
sapply(packages, require, character.only = T)
fish_df <- read_csv(here("data/regional_fish_data.csv")) %>%
mutate(region= factor(region, levels = c("Panam√°", "Florida",  "St. Croix", "Bonaire")))
coral_scar_df <- read.csv(here("data/processed_coral_scar_data_colony_level.csv"),
fileEncoding = "UTF-8") %>% #UTF-8 is compatible with accents/tildes
mutate(region= factor(region, levels = c("Panam√°", "Florida", "St. Croix", "Bonaire")))
site_coordinates <- read.csv(here("data/site_coordinates.csv"),
fileEncoding = "UTF-8") %>%
mutate(region= factor(region, levels = c("Panam√°", "Florida", "St. Croix", "Bonaire")))
#depth of each fish survey transect
depth_fish_surveys <- fish_df  %>%
group_by(region, site, transect) %>%
distinct(depth_m)%>%
rename(fish_survey_depth_m=depth_m)
#summary of the number of transects and depth range by site
summarized_n_depth_fish_surveys<-depth_fish_surveys %>%
group_by(region, site) %>%
dplyr::reframe(n_fish_surveys=n(),
min_fish_survey_depth_m =min(fish_survey_depth_m),
med_fish_survey_depth_m =round(median(fish_survey_depth_m), 1),
max_fish_survey_depth_m =max(fish_survey_depth_m))
#depth of each coral and scar survey
depth_coral_surveys <- coral_scar_df %>%
group_by(region, site, transect) %>%
distinct(depth_m) %>%
rename(coral_survey_depth_m=depth_m)
#summary of the number of surveys and depth range by site
summarized_n_depth_coral_surveys<-depth_coral_surveys %>%
group_by(region, site) %>%
dplyr::reframe(n_coral_surveys=n(),
min_coral_survey_depth_m =min(coral_survey_depth_m),
med_coral_survey_depth_m =round(median(coral_survey_depth_m), 1),
max_coral_survey_depth_m =max(coral_survey_depth_m))
#joining site-level sampling effort summary with site coordinates
table_s1 <- site_coordinates %>%
left_join(summarized_n_depth_fish_surveys) %>%
left_join(summarized_n_depth_coral_surveys)
write.csv(table_s1,
here("supplements/table_s1_site_coordinates_sample_size.csv"),
fileEncoding = "UTF-8",
row.names=FALSE)
#transect-level summary of fish density
major_corallivores_df <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #summarizing transect metadata
group_by(region, site, date, transect, depth_m, survey_l_m, survey_w_m) %>%
dplyr::reframe(n_major_corallivores=sum(count), sum_corallivore_weight_g=sum(weight_g)) %>%
ungroup()
#double checking that the fish abundance and total weight per transect summary has one row per transect
sum(table_s1$n_fish_surveys) == nrow(major_corallivores_df)
#summarizing metadata of for each fish survey transect
fish_survey_transect_metadata <- fish_df %>%
mutate(survey_area_m2=survey_l_m*survey_w_m) %>% #calculating the area surveyed per transect
select(region, site, date, transect, depth_m, survey_area_m2) %>%
distinct() %>% #to only have one row per transect
ungroup()
#double checking that the metadata only includes one row per transect
sum(table_s1$n_fish_surveys) == nrow(fish_survey_transect_metadata)
#merging data in transect-level summary of parrotfish density
pf_density_biomass_transect <- fish_survey_transect_metadata %>%
left_join(major_corallivores_df) %>% #adding in fish data
mutate(density_major_corallivores = n_major_corallivores/survey_area_m2*100, #calculating fish density (n/100 m2)
biomass_major_corallivores = sum_corallivore_weight_g/survey_area_m2*100) #calculating fish biomass (g/100 m2)
# Site-level summary of fish density
pf_density_biomass_site<- pf_density_biomass_transect %>%
group_by(region, site) %>%
dplyr::reframe(mean_density_major_corallivores=mean(density_major_corallivores),
mean_biomass_major_corallivores=mean(biomass_major_corallivores)) %>%
ungroup()
#function to calculate the standard error of the mean
sem <- function(x) {
sd(x, na.rm=TRUE)/sqrt(sum(!is.na(x)))
}
# Region-level summary of fish density
regional_parrotfish_density <- pf_density_biomass_site %>%
group_by(region) %>%
dplyr::reframe(
mean_pf_density=mean(mean_density_major_corallivores),
sem_pf_density=sem(mean_density_major_corallivores),
mean_pf_biomass=mean(mean_biomass_major_corallivores),
sem_pf_biomass=sem(mean_biomass_major_corallivores))
regional_parrotfish_density
pf_density_biomass_site
if (!require(here)) install.packages("here")
if (!require(tidyverse)) install.packages("tidyverse")
if (!require(janitor)) install.packages("janitor")
packages <- c("here", "tidyverse", "janitor")
sapply(packages, require, character.only = T)
FLA13_coral_scar_surveys <- read_csv(here("collaborator_data/Florida2013_Burkepile/fla2013_coral_scar_surveys.csv"))
if (!require(here)) install.packages("here")
if (!require(tidyverse)) install.packages("tidyverse")
if (!require(janitor)) install.packages("janitor")
packages <- c("here", "tidyverse", "janitor")
sapply(packages, require, character.only = T)
FLA13_coral_scar_surveys <- read_csv(here("collaborator_data/Florida2013_Burkepile/fla2013_coral_scar_surveys.csv"))
if (!require(here)) install.packages("here")
if (!require(tidyverse)) install.packages("tidyverse")
if (!require(janitor)) install.packages("janitor")
packages <- c("here", "tidyverse", "janitor")
sapply(packages, require, character.only = T)
FLA13_coral_scar_surveys <- read_csv(here("collaborator_data/Florida2013_Burkepile/fla2013_coral_scar_surveys.csv"))
View(coral_scar_df)
coral_scar_df
coral_scar_df %>%
filter(region=="Panam√°" & n_new_scars>0)
coral_scar_df %>%
filter(region=="Panam√°" & n_new_scars>0) %>%
group_by(site) %>%
reframe(total_scars=sum(n_new_scars))
