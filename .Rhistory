fig_coral_cover <- ggplot()+
geom_point(data=coral_scar_count_and_area_by_transect,
aes(y=region_short, x=percent_coral_cover, color=region_short),
alpha=0.5, position=position_jitter(height=0.25, width=0))+ #raw data, adj. jitter height not width bc coord flip
geom_boxplot(data=coral_scar_count_and_area_by_transect,
aes(y=region_short, x=percent_coral_cover, fill=region_short),
alpha=0.5, color="black", pch=21, size=0.5, outlier.shape = NA)+
#removed outlier points from boxplot in line above bc raw data points are plotted and they overlap
scale_colour_manual(values=region_palette)+
scale_fill_manual(values=region_palette)+
theme_bw()+
labs(x=expression(paste("Coral cover (%)"), y="Region"))+
facet_grid(~coral_genus)+
coord_flip()+
theme(legend.position = "none")
## fig b: scar area by genera and region
fig_pct_coral_predated <- ggplot()+
geom_point(data=coral_scar_count_and_area_by_transect,
aes(y=region_short, x=percent_coral_area_grazed, color=region_short),
alpha=0.5, position=position_jitter(height=0.25))+ #raw data, adj. jitter height not width bc coord flip
geom_boxplot(data=coral_scar_count_and_area_by_transect,
aes(y=region_short, x=percent_coral_area_grazed, fill=region_short),
alpha=0.5, color="black", pch=21, size=0.5,outlier.shape = NA)+
#removed outlier points from boxplot in line above bc raw data points are plotted and they overlap
scale_colour_manual(values=region_palette)+
scale_fill_manual(values=region_palette)+
theme_bw()+
labs(x="Area preyed upon (%)         ", y="Region")+ #spacing after (%) intentional. hacky, but it works.
facet_grid(~coral_genus)+
coord_flip()+
theme(legend.position = "none")
# making a combo figure
## removing redundant x-axis title from top figure before combing figures
fig_relative_coral_area_grazed_a <-fig_coral_cover  +
theme(strip.text.x = element_text( margin=margin(0.25,0,1,0, "cm")),
strip.text.y = element_text(angle = 0, hjust = 0),
axis.title.x=element_blank(),
axis.ticks.x=element_blank())
## removing redundant facet ribbon from bottom figure before combing figures
fig_relative_coral_area_grazed_b <- fig_pct_coral_predated+
theme(strip.background = element_blank(),
strip.text.x = element_blank())
## combining coral cover and percent area grazed in one plot
fig_relative_coral_area_grazed_combo <- ggpubr::ggarrange(fig_relative_coral_area_grazed_a,
fig_relative_coral_area_grazed_b,
align = c("v"),
labels=c("a", "b"),
heights = c(1.2, 1), #so graphs are same height despite ribbon on top panel
nrow=2, ncol=1)
# adding coral icons to figure
## adding icons to figure (from images read in above, in prior chunk)
fig_relative_coral_area_grazed_final <- cowplot::ggdraw() +
draw_plot(fig_relative_coral_area_grazed_combo)+
draw_image(agaricia_image, x = -0.36, y = 0.385, scale=0.11)+
draw_image(madracis_image, x = -0.21, y = 0.385, scale=0.082)+
draw_image(orbicella_image, x = -0.05, y = 0.385, scale=0.064)+
draw_image(porites_image, x = 0.105, y = 0.385, scale=0.059)+
draw_image(siderastrea_image, x = 0.264, y = 0.385, scale=0.049)+
draw_image(stephanocinea_image, x = 0.417, y = 0.385, scale=0.059)
fig_relative_coral_area_grazed_final
# saving figure
ggsave(plot=fig_relative_coral_area_grazed_final, filename=here("figures_tables/supplements_figs/figs4_coral_area_grazed.jpg"), width = 215, height = 110, dpi = 600, units = "mm")
model_pf_density <- aov(mean_pf_n_100m2 ~ region, data = fish_corals_site_level)
# testing model assumptions: violations of normality assumption for overall model
rstatix::shapiro_test(residuals(model_pf_density))
# testing model assumptions: violations of normality assumption by region for Panam치
fish_corals_site_level %>% group_by(region) %>% rstatix::shapiro_test(mean_pf_n_100m2)
# testing model assumptions: outliers by region via IQR method (Punta STRI in Panam치 and BIRNM Lagoon in St. Croix are outliers)
fish_corals_site_level %>% group_by(region) %>% rstatix::identify_outliers(mean_pf_n_100m2)
# testing model assumptions: no evidence of significant violations of homogeneity of variance
fish_corals_site_level %>% rstatix::levene_test(mean_pf_n_100m2 ~ region)
# Kruskal-Wallis test & post hoc Dunn test
kruskal.test(mean_pf_n_100m2 ~ region, data=fish_corals_site_level)
fish_corals_site_level %>% rstatix::dunn_test(mean_pf_n_100m2 ~ region, p.adjust.method = "BH", detailed = FALSE) #post hoc test
model_pf_biomass <- aov(mean_pf_g_100m2 ~ region, data = fish_corals_site_level)
# testing model assumptions: violations of normality assumption for overall model
rstatix::shapiro_test(residuals(model_pf_biomass))
# testing model assumptions: significant violations of normality assumption by region for Panam치 and St. Croix
fish_corals_site_level %>% group_by(region) %>% rstatix::shapiro_test(mean_pf_g_100m2)
# yesting model assumptions: outliers by region via IQR method (Punta STRI in Panam치 and BIRNM Lagoon in St. Croix are outliers)
fish_corals_site_level %>% group_by(region) %>% rstatix::identify_outliers(mean_pf_g_100m2)
# testing model assumptions: no evidence of significant violations of homogeneity of variance
fish_corals_site_level %>% rstatix::levene_test(mean_pf_g_100m2 ~ region)
# Kruskal-Wallis test & post hoc Dunn test
kruskal.test(mean_pf_g_100m2 ~ region, data=fish_corals_site_level) #sig differences by region
fish_corals_site_level %>% rstatix::dunn_test(mean_pf_g_100m2 ~ region, p.adjust.method = "BH", detailed = FALSE)
model_pct_coral_cover <- aov(mean_pct_coral_cover ~ region, data = fish_corals_site_level)
# testing model assumptions: no evidence of violations of normality assumption for overall model
rstatix::shapiro_test(residuals(model_pct_coral_cover))
# testing model assumptions: significant violations of normality assumption by region for Florida
fish_corals_site_level %>% group_by(region) %>% rstatix::shapiro_test(mean_pct_coral_cover)
# testing model assumptions: outliers by region via IQR method (French Reef in Florida is outlier)
fish_corals_site_level %>% group_by(region) %>% rstatix::identify_outliers(mean_pct_coral_cover)
# tTesting model assumptions: significant violations of homogeneity of variance
fish_corals_site_level %>% rstatix::levene_test(mean_pct_coral_cover ~ region)
# Kruskal-Wallis test & post hoc Dunn test
kruskal.test(mean_pct_coral_cover ~ region, data=fish_corals_site_level) #sig differences by region
fish_corals_site_level %>%  rstatix::dunn_test(mean_pct_coral_cover ~ region, p.adjust.method = "BH", detailed = FALSE)
model_scar_density_region <- aov(log(mean_scars_m2_coral) ~ region, data = fish_corals_site_level)
# testing model assumptions: no evidence of violations of normality assumption for overall model
rstatix::shapiro_test(residuals(model_scar_density_region))
# testing model assumptions: no evidence of violations of normality assumption by region
fish_corals_site_level %>% group_by(region) %>% mutate(ln_mean_scars_m2_coral=log(mean_scars_m2_coral)) %>%
rstatix::shapiro_test(ln_mean_scars_m2_coral)
# testing model assumptions: no outliers by region via IQR method
fish_corals_site_level %>% group_by(region) %>% mutate(ln_mean_scars_m2_coral=log(mean_scars_m2_coral)) %>%
rstatix::identify_outliers(ln_mean_scars_m2_coral)
# testing model assumptions: no significant violations of homogeneity of variance
fish_corals_site_level %>% rstatix::levene_test(log(mean_scars_m2_coral) ~ region)
# visual assesment of model residuals
plot(model_scar_density_region)
# ANOVA model summary
summary(model_scar_density_region)
TukeyHSD(model_scar_density_region) #post hoc comparison
model_pct_grazed_region <- aov(log(mean_pct_coral_grazed) ~ region, data = fish_corals_site_level)
# testing model assumptions: violations of normality for overall model
rstatix::shapiro_test(residuals(model_pct_grazed_region))
# testing model assumptions: violations of normality by region (St. Croix)
fish_corals_site_level %>% group_by(region) %>% mutate(ln_mean_pct_coral_grazed=log(mean_pct_coral_grazed)) %>%
rstatix::shapiro_test(ln_mean_pct_coral_grazed)
# testing model assumptions: outliers by region via IQR method (Teague Bay in St. Croix is outlier)
fish_corals_site_level %>% group_by(region) %>% mutate(ln_mean_pct_coral_grazed=log(mean_pct_coral_grazed)) %>%
rstatix::identify_outliers(ln_mean_pct_coral_grazed)
# testing model assumptions: no significant violations of homogeneity of variance
fish_corals_site_level %>% rstatix::levene_test(log(mean_pct_coral_grazed) ~ region)
# Kruskal-Wallis test & post hoc Dunn test
kruskal.test(log(mean_pct_coral_grazed) ~ region, data = fish_corals_site_level) #sig differences by region
fish_corals_site_level %>% mutate(ln_mean_pct_coral_grazed=log(mean_pct_coral_grazed)) %>%
rstatix::dunn_test(ln_mean_pct_coral_grazed ~ region, p.adjust.method = "BH", detailed = FALSE)
# scar density ~ corallivore density
site_level_scar_density_by_corallivore_density <- fish_corals_site_level %>%
ggplot()+
geom_smooth(aes(x=mean_pf_n_100m2, y=mean_scars_m2_coral, color=region),method="lm")+
geom_point(aes(x=mean_pf_n_100m2, y=mean_scars_m2_coral, color=region), alpha=0.7)+
scale_color_manual(values=region_palette)+
scale_y_continuous(trans = scales::log_trans(),
breaks= c(0.05, 0.5, 5, 50, 500),
labels= c(0.05, 0.5, 5, 50, 500))+
scale_x_continuous(expand = c(0.1, 0))+ #values near 0 cutoff, expands x-axis to resolve issue
labs(x=expression(paste("Major corallivore density (n 100 ", m^-2, ")")),
y=expression(paste("Scar density (n ", m^-2, " coral)")),
color="Region")  +
theme_bw()+
rremove("x.title") +
rremove("x.ticks") +
rremove("x.text")
# coral area grazed ~ corallivore density
site_level_coral_area_grazed_by_corallivore_density <- fish_corals_site_level %>%
ggplot()+
geom_smooth(aes(x=mean_pf_n_100m2, y=mean_pct_coral_grazed, color=region), method="lm")+
geom_point(aes(x=mean_pf_n_100m2, y=mean_pct_coral_grazed, color=region), alpha=0.7)+
scale_color_manual(values=region_palette)+
scale_y_continuous(trans = scales::log_trans(),
breaks= c(0.00025, 0.0025, 0.025, 0.25, 2.5),
labels= c("0.00025", 0.0025, 0.025, 0.25, 2.5))+
scale_x_continuous(expand = c(0.1, 0))+ #values near 0 cutoff, expands x-axis to resolve issue
labs(x=expression(paste("Major corallivore density (n 100 ", m^-2, ")")),
y=expression(paste("Coral area preyed upon (%)")),
color="Region") +
theme_bw()
# scar density ~ coral cover
site_level_scar_density_by_coral_cover <- fish_corals_site_level %>%
ggplot()+
geom_smooth(aes(y=mean_scars_m2_coral, x=mean_pct_coral_cover, color=region), method="lm")+
geom_jitter(aes(y=mean_scars_m2_coral, x=mean_pct_coral_cover, color=region), alpha=0.7)+
scale_colour_manual(values=region_palette)+
scale_y_continuous(trans = scales::log_trans(),
breaks= c(0.05, 0.5, 5, 50, 500),
labels= c(0.05, 0.5, 5, 50, 500))+
labs(y=expression(paste("Scar density (n ", m^-2, " coral)")), x="Coral cover (%)", color="Region")+
theme_bw()+
theme(legend.position = "top")+
rremove("x.title") +
rremove("x.ticks") +
rremove("x.text")+
rremove("y.title") +
rremove("y.ticks") +
rremove("y.text")
# coral area grazed ~ coral cover
site_level_coral_area_grazed_by_coral_cover <- fish_corals_site_level %>%
ggplot()+
geom_smooth(aes(y=mean_pct_coral_grazed, x=mean_pct_coral_cover, color=region), method="lm")+
geom_jitter(aes(y=mean_pct_coral_grazed, x=mean_pct_coral_cover, color=region), alpha=0.7)+
scale_colour_manual(values=region_palette)+
scale_y_continuous(trans = scales::log_trans(),
breaks= c(0.00025, 0.0025, 0.025, 0.25, 2.5),
labels= c("0.00025", 0.0025, 0.025, 0.25, 2.5))+
labs(y="Coral area preyed upon (%)", x="Coral cover (%)", color="Region")+
theme_bw()+
theme(legend.position = "top")+
rremove("y.title") +
rremove("y.ticks") +
rremove("y.text")
# making four panel plot in two parts to overcome weird spacing issues when making a four panel plot directly
site_level_corallivory_patterns_ac <- ggpubr::ggarrange(site_level_scar_density_by_corallivore_density +
theme(plot.margin =unit(c(t = 5, r = 5, b = 5, l = 25), "pt"))+
rremove("legend"),
site_level_coral_area_grazed_by_corallivore_density+
theme(plot.margin =unit(c(t = 5, r = 5, b = 5, l = 25), "pt"),
axis.title.x = element_text(margin = margin(t = 2.5, r = 0, b = 0, l = 0)))+
rremove("legend"), labels=c("a", "c"),
nrow=2, ncol=1, align="v", heights=c(1, 1.15))
site_level_corallivory_patterns_bd <- ggpubr::ggarrange(site_level_scar_density_by_coral_cover+
theme(plot.margin =unit(c(t = 0, r = 5, b = 5, l = 25), "pt"))+
rremove("legend"),
site_level_coral_area_grazed_by_coral_cover+
theme(plot.margin =unit(c(t = 5, r = 5, b = 0, l = 25), "pt"),
axis.title.x = element_text(
margin = margin(t = 7.5, r = 0, b = 0, l = 0)))+
rremove("legend"), labels=c("b", "d"),
nrow=2, ncol=1, align="v", heights=c(1, 1.15))
site_level_corallivory_patterns_temp <- ggpubr::ggarrange(site_level_corallivory_patterns_ac,
site_level_corallivory_patterns_bd+
theme(plot.margin =unit(c(5, 5, 5, 5), "pt")),
widths=c(1.15, 1))
common_legend <- ggpubr::get_legend(site_level_scar_density_by_coral_cover) %>%
as_ggplot()
site_level_corallivory_patterns <- ggpubr::ggarrange(common_legend,
site_level_corallivory_patterns_temp,
nrow=2, ncol=1, heights = c(1,10))
# image/icon placement will look off in the chunk output but correct in the saved image
site_level_corallivory_patterns_with_images <- cowplot::ggdraw() +
draw_plot(site_level_corallivory_patterns)+
draw_image(major_corallivore_icon,  x = -0.38, y = -0.47, scale=0.08) + #adds the major pf icon
draw_image(coral_icon, x = 0.175, y = -0.47, scale=0.055)+ #adds the coral
draw_image(corallivory_icon,  x = -0.448, y = 0.379, scale=0.055) + #adds corallivory icon
draw_image(corallivory_icon,  x = -0.448, y = -0.04, scale=0.055) #adds corallivory icon
site_level_corallivory_patterns_with_images
ggsave(plot=site_level_corallivory_patterns_with_images,
filename=here("figures_tables/fig3_corallivory_by_coral_and_fish.jpg"),
width = 215, height = 160, dpi = 600, units = "mm")
# scar density ~ corallivore biomass
site_level_scar_density_by_corallivore_biomass <-
fish_corals_site_level %>%
ggplot()+
geom_smooth(aes(x=mean_pf_g_100m2, y=mean_scars_m2_coral, color=region),method="lm")+
geom_point(aes(x=mean_pf_g_100m2, y=mean_scars_m2_coral, color=region), alpha=0.7)+
scale_color_manual(values=region_palette)+
scale_y_continuous(trans = scales::log_trans(),
breaks= c(0.05, 0.5, 5, 50, 500),
labels= c(0.05, 0.5, 5, 50, 500))+
scale_x_continuous(expand = c(0.1, 0),
breaks= c(0, 500, 1000,1500, 2000, 2500),
labels= c(0, 500, 1000, 1500, 2000, 2500))+ #values near 0 cutoff, expands x-axis to resolve issued
labs(x=expression(paste("Major corallivore biomass (g 100 ", m^-2, ")")),
y=expression(paste("Scar density (n ", m^-2, " coral)")),
color="Region")  +
theme_bw()+
theme(legend.position = "top")+
rremove("x.title") +
rremove("x.ticks") +
rremove("x.text")+
rremove("y.title") +
rremove("y.ticks") +
rremove("y.text")
# coral area grazed ~ corallivore biomass
site_level_coral_area_grazed_by_corallivore_biomass <-
fish_corals_site_level %>%
ggplot()+
geom_smooth(aes(x=mean_pf_g_100m2, y=mean_pct_coral_grazed, color=region), method="lm")+
geom_point(aes(x=mean_pf_g_100m2, y=mean_pct_coral_grazed, color=region), alpha=0.7)+
scale_color_manual(values=region_palette)+
scale_y_continuous(trans = scales::log_trans(),
breaks= c(0.00025, 0.0025, 0.025, 0.25, 2.5),
labels= c("0.00025", 0.0025, 0.025, 0.25, 2.5))+
scale_x_continuous(expand = c(0.1, 0),
breaks= c(0, 500, 1000,1500, 2000, 2500),
labels= c(0, 500, 1000, 1500, 2000, 2500))+ #values near 0 cutoff, expands x-axis to resolve issue
labs(x=expression(paste("Major corallivore biomass (g 100 ", m^-2, ")")),
y=expression(paste("Coral area preyed upon (%)")),
color="Region") +
theme_bw()+
theme(legend.position = "top")+
rremove("y.title") +
rremove("y.ticks") +
rremove("y.text")
# making combo figure
fig_corallivory_by_pf_biomass_site <- ggarrange(site_level_scar_density_by_corallivore_biomass,
site_level_coral_area_grazed_by_corallivore_biomass,
nrow=2, ncol=1, legend="none", labels=c("b", "d"))
site_level_fish_density_biomass_temp <- ggpubr::ggarrange(site_level_corallivory_patterns_ac,
fig_corallivory_by_pf_biomass_site+
theme(plot.margin =unit(c(5, 5, 5, 5), "pt")),
widths=c(1.15, 1))
common_legend <- ggpubr::get_legend(site_level_scar_density_by_coral_cover) %>%
as_ggplot()
site_level_fish_density_biomass <- ggpubr::ggarrange(common_legend,
site_level_fish_density_biomass_temp,
nrow=2,
ncol=1,
heights = c(1,10))
# making four panel plot in two parts to overcome weird spacing issues when making a four panel plot directly
site_level_corallivory_patterns_ac <- ggpubr::ggarrange(site_level_scar_density_by_corallivore_density +
theme(plot.margin =unit(c(l=5, r=5, t=5, b=0), "pt"))+
rremove("legend"),
site_level_scar_density_by_corallivore_biomass+
theme(plot.margin =unit(c(l=5, r=5, t=5, b=5), "pt"))+
rremove("legend")+
rremove("ylab"),
site_level_coral_area_grazed_by_corallivore_density+
theme(plot.margin =unit(c(l=5, r=5, t=5, b=0), "pt"))+
rremove("legend"),
site_level_coral_area_grazed_by_corallivore_biomass+
theme(plot.margin =unit(c(l=5, r=5, t=5, b=5), "pt"))+
rremove("legend")+
rremove("ylab"),
nrow=2,
ncol=2,
labels=c("a","b","c","d"),
heights=c(1, 1.15, 1, 1.15),
common.legend = TRUE)
# making four panel plot in two parts to overcome weird spacing issues when making a four panel plot directly
site_level_corallivory_patterns_supp_bd <- ggpubr::ggarrange(site_level_scar_density_by_corallivore_biomass+
theme(plot.margin =unit(c(t = 0, r = 5, b = 5, l = 25), "pt"))+
rremove("legend"),
site_level_coral_area_grazed_by_corallivore_biomass+
theme(plot.margin =unit(c(t = 5, r = 5, b = 0, l = 25), "pt"),
axis.title.x = element_text(
margin = margin(t = 7.5, r = 0, b = 0, l = 0)))+
rremove("legend"),
nrow=2,
ncol=1,
align="v",
labels=c("b", "d"),
heights=c(1, 1.15))
site_level_corallivory_patterns_supp_temp <- ggpubr::ggarrange(site_level_corallivory_patterns_ac, #fig a-c made in previous chunk
site_level_corallivory_patterns_supp_bd+
theme(plot.margin =unit(c(5, 5, 5, 5), "pt")),
widths=c(1.15, 1))
site_level_corallivory_patterns_supp <- ggpubr::ggarrange(common_legend, #common legend object made in previous chunk
site_level_corallivory_patterns_temp,
nrow=2,
ncol=1,
heights = c(1,10))
ggsave(plot=site_level_corallivory_patterns_supp,
filename=here("figures_tables/supplements_figs/fig_corallivory_by_pf_biomass_density_site.jpg"),
width = 215, height = 160, dpi = 600, units = "mm")
set.seed(1945) #for reproducible results from random simulations of residuals
## random-slope and intercept model with interaction: warnings - model is not identifiable/won't converge (for both gaussian and t distributions)
m1_scar_pf_density_gauss <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ mean_pf_n_100m2*mean_pct_coral_cover + (mean_pf_n_100m2 + mean_pct_coral_cover | region), data = fish_corals_site_level, family=gaussian)
m1_scar_pf_density <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ mean_pf_n_100m2*mean_pct_coral_cover + (mean_pf_n_100m2 + mean_pct_coral_cover | region), data = fish_corals_site_level, family=t_family)
# random-intercept model model with interaction (no explanatory variable transformation)
# Gaussian model
m2_scar_pf_density_gauss <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ mean_pf_n_100m2*mean_pct_coral_cover + (1 | region), data = fish_corals_site_level, family=gaussian)
m2_scar_pf_density_residuals_gauss <- DHARMa::simulateResiduals(m2_scar_pf_density_gauss, n = 1000, use.u = T) #evaluating model fit
plot(m2_scar_pf_density_residuals_gauss) #odd residual versus predicted pattern, trying transformation
# t-family model
m2_scar_pf_density <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ mean_pf_n_100m2*mean_pct_coral_cover + (1 | region), data = fish_corals_site_level, family=t_family)
m2_scar_pf_density_residuals <- DHARMa::simulateResiduals(m2_scar_pf_density, n = 1000, use.u = T) #evaluating model fit
plot(m2_scar_pf_density_residuals) #odd residual versus predicted pattern, trying transformation. But, looks better than Gaussian.
# random-intercept model model with interaction
m3_scar_pf_density <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ sqrt(mean_pf_n_100m2)*mean_pct_coral_cover + (1 | region), data = fish_corals_site_level, family=t_family)
m3_scar_pf_density_residuals <- DHARMa::simulateResiduals(m3_scar_pf_density, n = 1000, use.u = T) #evaluating model fit
plot(m3_scar_pf_density_residuals) #looks better
#looking at residuals by region - nothing seems very extreme
bind_cols(m3_scar_pf_density_residuals$fittedResiduals, fish_corals_site_level$region) %>%
rename(y = `...1`,
region = `...2`) %>%
ggplot(aes(x = 1:26, y = y, color = region)) +
geom_point()
m3_scar_pf_density %>% summary()
# random-intercept model model without interaction
m4_scar_pf_density <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ sqrt(mean_pf_n_100m2)+mean_pct_coral_cover + (1 | region), data = fish_corals_site_level, family=t_family)
m4_scar_pf_density_residuals <- DHARMa::simulateResiduals(m4_scar_pf_density, n = 1000, use.u = T) #evaluating model fit
plot(m4_scar_pf_density_residuals)
m4_scar_pf_density %>% summary() #model results similar to previous model
#tidying model output and calculating confidence intervals
m3_scar_pf_density_ci <- confint(m3_scar_pf_density) %>% as_tibble() %>% select(-Estimate)
scar_pf_density_model_output <- m3_scar_pf_density %>%
broom.mixed::tidy() %>%
filter(term != "sd__Observation") %>%
bind_cols(m3_scar_pf_density_ci) %>%
filter(effect!="ran_pars") %>%
janitor::clean_names() %>%
rename(ci_2.5 = x2_5_percent, ci_97.5=x97_5_percent) %>%
mutate(model="M1 - Scar density") %>%
select(model, term, statistic, p_value, estimate, ci_2.5, ci_97.5) %>%
mutate(across(where(is.double), ~round(.x, 3)))
scar_pf_density_model_output
## random-slope and intercept model with interaction: warnings - model is not identifiable/won't converge (for both gaussian and t distributions)
m1_scar_pf_density_gauss <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ mean_pf_n_100m2*mean_pct_coral_cover + (mean_pf_n_100m2 + mean_pct_coral_cover | region), data = fish_corals_site_level, family=gaussian)
m1_scar_pf_density <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ mean_pf_n_100m2*mean_pct_coral_cover + (mean_pf_n_100m2 + mean_pct_coral_cover | region), data = fish_corals_site_level, family=t_family)
# random-intercept model model with interaction (no explanatory variable transformation)
# Gaussian model
m2_scar_pf_density_gauss <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ mean_pf_n_100m2*mean_pct_coral_cover + (1 | region), data = fish_corals_site_level, family=gaussian)
m2_scar_pf_density_residuals_gauss <- DHARMa::simulateResiduals(m2_scar_pf_density_gauss, n = 1000, use.u = T) #evaluating model fit
plot(m2_scar_pf_density_residuals_gauss) #odd residual versus predicted pattern, trying transformation
# t-family model
m2_scar_pf_density <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ mean_pf_n_100m2*mean_pct_coral_cover + (1 | region), data = fish_corals_site_level, family=t_family)
m2_scar_pf_density_residuals <- DHARMa::simulateResiduals(m2_scar_pf_density, n = 1000, use.u = T) #evaluating model fit
plot(m2_scar_pf_density_residuals) #odd residual versus predicted pattern, trying transformation. But, looks better than Gaussian.
# random-intercept model model with interaction
m3_scar_pf_density_gauss <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ sqrt(mean_pf_n_100m2)*mean_pct_coral_cover + (1 | region), data = fish_corals_site_level, family=gaussian)
m3_scar_pf_density <- glmmTMB::glmmTMB(log(mean_scars_m2_coral) ~ sqrt(mean_pf_n_100m2)*mean_pct_coral_cover + (1 | region), data = fish_corals_site_level, family=t_family)
anova(m3_scar_pf_density_gauss, m3_scar_pf_density)
m3_scar_pf_density_residuals <- DHARMa::simulateResiduals(m3_scar_pf_density, n = 1000, use.u = T) #evaluating model fit
plot(m3_scar_pf_density_residuals) #looks better
anova(m2_scar_pf_density_gauss, m2_scar_pf_density)
# likelihood ratio test of model using t-distribution versus Gaussian distribution: t-dist sig better
anova(mean_scar_size_t, mean_scar_size_gaussian)
#comparing model with gaussian versus t distributions
mean_scar_size_gaussian <- glmmTMB::glmmTMB(log(mean_scar_area_cm2) ~ log(col_area_cm2) + coral_species + depth_m+ region+
(1 | site/transect), #transects nested within sites within regions
family=gaussian,
data = predated_colonies_subset)
mean_scar_size_t <- glmmTMB::glmmTMB(log(mean_scar_area_cm2) ~ log(col_area_cm2) + coral_species + depth_m + region+
(1 | site/transect), #transects nested within sites within regions
family=t_family,
data = predated_colonies_subset)
predated_colonies_subset <- coral_scar_df %>%
mutate(pct_grazed=total_grazed_cm2/col_area_cm2*100) %>%
filter(n_new_scars>0) %>%
#organizing as factor so the Branching Porites spp. cat is grouped with P. astreoides
mutate(coral_species=factor(coral_species, levels = c("Agaricia agaricites", "Agaricia humilis", "Agaricia tenuifolia", "Agaricia spp.", "Madracis auretenra", "Madracis decactis", "Orbicella annularis", "Orbicella faveolata", "Branching Porites spp.", "Porites astreoides", "Siderastrea siderea", "Stephanocoenia intersepta"))) %>%
mutate(region= factor(region, levels = c("Panam치", "Florida",  "St. Croix", "Bonaire")))
#comparing model with gaussian versus t distributions
mean_scar_size_gaussian <- glmmTMB::glmmTMB(log(mean_scar_area_cm2) ~ log(col_area_cm2) + coral_species + depth_m+ region+
(1 | site/transect), #transects nested within sites within regions
family=gaussian,
data = predated_colonies_subset)
set.seed(1945) #for reproducible results from random simulations of residuals
#comparing model with gaussian versus t distributions
mean_scar_size_gaussian <- glmmTMB::glmmTMB(log(mean_scar_area_cm2) ~ log(col_area_cm2) + coral_species + depth_m+ region+
(1 | site/transect), #transects nested within sites within regions
family=gaussian,
data = predated_colonies_subset)
mean_scar_size_t <- glmmTMB::glmmTMB(log(mean_scar_area_cm2) ~ log(col_area_cm2) + coral_species + depth_m + region+
(1 | site/transect), #transects nested within sites within regions
family=t_family,
data = predated_colonies_subset)
# likelihood ratio test of model using t-distribution versus Gaussian distribution: t-dist sig better
anova(mean_scar_size_t, mean_scar_size_gaussian)
pct_grazed_gaussian <- glmmTMB::glmmTMB(log(pct_grazed) ~ log(col_area_cm2) + coral_species+ depth_m + region+
(1 | site/transect), #transects nested within sites within regions
family=gaussian,
data = predated_colonies_subset)
pct_grazed_t <- glmmTMB::glmmTMB(log(pct_grazed) ~ log(col_area_cm2) + coral_species + depth_m + region+
(1 | site/transect), #transects nested within sites within regions
family=t_family,
data = predated_colonies_subset)
#checking model residuals
pct_grazed_residuals <- DHARMa::simulateResiduals(pct_grazed, n = 1000, use.u = T)
plot(pct_grazed_residuals) #dispersion and KS good, sig outliers
#checking model residuals
pct_grazed_residuals <- DHARMa::simulateResiduals(pct_grazed_gaussian, n = 1000, use.u = T)
plot(pct_grazed_residuals) #dispersion and KS good, sig outliers
# likelihood ratio test of model using t-distribution versus Gaussian distribution: no sig diff
anova(pct_grazed_t, pct_grazed_gaussian)
# likelihood ratio test of model using t-distribution versus Gaussian distribution: no sig diff
anova(pct_grazed_t, pct_grazed_gaussian)
# simulating residuals and visualizing model fit: visuals confirm t-distribution
pct_grazed_gaussian_residuals <- DHARMa::simulateResiduals(pct_grazed_gaussian, n = 1000, use.u = T)
mean_scar_size_t_residuals <- DHARMa::simulateResiduals(pct_grazed_t, n = 1000, use.u = T)
#diagnostic plots confirm t-distribution is a better fit
plot(mean_scar_size_gaussian_residuals)
# simulating residuals and visualizing model fit: visuals confirm t-distribution
pct_grazed_gaussian_residuals <- DHARMa::simulateResiduals(pct_grazed_gaussian, n = 1000, use.u = T)
mean_scar_size_t_residuals <- DHARMa::simulateResiduals(pct_grazed_t, n = 1000, use.u = T)
#diagnostic plots confirm t-distribution is a better fit
plot(mean_scar_size_gaussian_residuals)
#diagnostic plots confirm t-distribution is a better fit
plot(pct_grazed_gaussian_residuals)
plot(mean_scar_size_t_residuals)
#installs packages if not on the users computer
if (!require(here)) install.packages("here")
if (!require(ggmap)) install.packages("ggmap")
if (!require(ggrepel)) install.packages("ggrepel")
if (!require(ggspatial)) install.packages("ggspatial")
if (!require(sf)) install.packages("sf")
if (!require(tidyverse)) install.packages("tidyverse")
packages <- c("here", "ggmap", "ggrepel", "ggspatial", "sf", "tidyverse") #list of packages needed
sapply(packages, require, character.only = T) #loading packages in list
#static caribbean basemap in high resolution
carib_basemap <- st_read(here("data/Caribbean_shapefiles_mapping/Carib5.shp"))
region_data <- tibble(region = c("Florida (n=4)", "St. Croix (n=8)", "Bonaire (n=4)", "Panam치 (n=10)"),
latitude = c(24.9822685, 17.7362838, 12.1841076, 9.351736),
longitude = c(-80.3889687, -64.7626946, -68.2668218, -82.257520))
Caribbean_site_map <- ggplot(data = carib_basemap) +
geom_sf() + #adding basemap
coord_sf(xlim = c(-99, -58), ylim = c(8, 32), expand = FALSE) + #setting basemap dimensions
labs(x="", y="")+
theme_linedraw()+
theme(panel.border = element_rect(colour = "black",  linewidth = 1, linetype = "solid"),
panel.background = element_rect(fill = "white", colour = "black",  size = 0.5, linetype = "solid"),
panel.grid.major = element_blank())+
annotate(geom = "text", x = -90, y = 25, label = "Gulf of Mexico", fontface = "italic", color = "black", size = 5) +
annotate(geom = "text", x = -77, y = 15, label = "Caribbean Sea", fontface = "italic", color = "black", size = 5) +
ggrepel::geom_label_repel(data = region_data, aes(x = longitude, y = latitude, label = region), #jittering label up and right
fontface = "bold",
nudge_x = c(1, 1, 1, 1),
nudge_y = c(2, 2, 2, 2),
color="black",
segment.color=c("#FE4248","#8266FF", "#520E44","#00B1EA"), #region order: FLA, STX, BON, PAN
size = 5,
fill=c("#FCAFB1","#AD9DF1", "#AC86A4","#8CD7F0")) +
geom_point(data = region_data, aes(x = longitude, y = latitude), size = 3,  shape = 16, color = c("#FE4248","#8266FF", "#520E44","#00B1EA")) +
ggspatial::annotation_scale(line_width = 0.5, width_hint=0.2, pad_x = unit(0.3, "cm")) + #adds scale bar
ggspatial::annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"), style = north_arrow_fancy_orienteering) #adds north arrow in lower right, padded above scale bar
Caribbean_site_map
ggsave(plot=Caribbean_site_map, filename=here("figures_tables/fig1_map/Caribbean_site_map.jpg"), width = 215, height = 110, dpi = 600, units = "mm")
if (!require(devtools)) install.packages("devtools")  #for installing from a few of the following packages from github
library(devtools)
#installs packages if not on the users computer
if (!require(leaflet)) install.packages("leaflet") # for interactive maps
if (!require(ggmap)) devtools::install_github("dkahle/ggmap") #for happy coding with ggmaps
if (!require(ggspatial)) install.packages("ggspatial") #for mapping in ggplot
if (!require(sf)) install.packages("sf") #for creating maps
if (!require(ggrepel)) install.packages("ggrepel") #for text repel/jitter on map
#create a list of packages to load at once
packages <- c("leaflet", "ggmap", "tidyverse","ggspatial", "sf",  "ggrepel")
sapply(packages, require, character.only = T)
